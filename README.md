# XODA-Sapphire

4レーン+2レーンのシンプルな音楽ゲームです。
XODA-projectの後継プロジェクトです。

# ゲームの詳細な仕様について

Sapphireのゲーム内部の詳細な仕様について解説します。

## 動作環境

- Windows 10/11 64bit版
- Intel Core i3、またはRyzen 3以上を推奨
- メモリ 4GB以上
- DirectX 9以上が動作し、メモリを1GB以上搭載するグラフィックカード
- 5GB以上の空き領域が存在するストレージ
- 安定したインターネット接続環境
- Nキーロールオーバー対応キーボードを推奨
- 1024x768、1280x720、1920x1080のいずれかが60hzで表示可能なモニター

## 判定について

難易度区分（Normal,Hard,Chaos）によって判定は異なり、判定幅は以下のようになっています。

|              | Excellent | Great | Good  | Bad   | Miss  |
| ------------ | --------- | ----- | ----- | ----- | ----- |
| Normal難易度 | 40ms      | 80ms  | 120ms | 160ms | 240ms |
| Hard難易度   | 30ms      | 60ms  | 100ms | 120ms | 200ms |
| Chaos難易度  | 20ms      | 40ms  | 80ms  | 120ms | 160ms |

なお、ゲーム内部のフレームレートは60hz固定の垂直同期であるため判定幅フレームは± n[ms]/(1000[ms]/60[hz]) [F]となります。

## 処理落ちについて

プレイ中のノーツの落下処理は同期処理であるため、プレイ中に処理落ちが発生した場合は必然的にBGMとノーツの判定に差が生まれます。

ただし、キーサウンド等も同期処理であるため、**イベントサウンドを主にBGMとして使用している譜面（bmsからの移植楽曲など）はこの影響を受けません。**

## ノーツの落下速度について

毎フレームで落下するノーツの移動量は以下の式で算出されます。

`1000/fps*(bpm/400)*speed`

`fps`=フレームレート、`bpm`=その時点でのBPM値、`speed`=プレイヤーが設定した速度

## ゲージについて

プレイした楽曲をクリアしたかどうか判別するゲージは以下の種類が存在します。

- Assistゲージ（増加式）
- Normalゲージ（増加式、デフォルト）
- Expertゲージ（減少式）
- Madnessゲージ（減少式）

AssistゲージとNormalゲージはプレイ終了時点で70%以上ゲージが存在していればクリアとなり、
ExpertゲージとMadnessゲージはプレイ終了時にゲージが残っていればクリアとなります。

**※ExpertゲージとMadnessゲージはプレイ中にゲージが0%に達するとFailedの扱いになります。**

### ゲージの増加量と減少量について

プレイ全体で増加するゲージの総量は以下の式で算出されます。

※`total`=ゲージの総量、`max`=オブジェクト判定数

- オブジェクト判定数が400未満の場合

  `total=max*0.55+100`

- オブジェクト判定数が400以上、550未満の場合

  `total=max*0.4+70`

- オブジェクト判定数が550以上の場合

  `total=max*0.25+80`

また、各判定別でのゲージの増加量は以下の式で算出されます。

|         | Excellent   | Great           | Good | Bad  | Miss  |
| ------- | ----------- | --------------- | ---- | ---- | ----- |
| Assist  | `total/max` | `total/max*0.5` | `0`  | `-1` | `-2`  |
| Normal  | `total/max` | `total/max*0.5` | `0`  | `-2` | `-4`  |
| Expert  | `total/max` | `total/max*0.5` | `0`  | `-4` | `-8`  |
| Madness | `total/max` | `total/max*0.5` | `0`  | `-8` | `-16` |

## 能力値について

能力値とは楽曲の難易度、スコア、コンボなどを総合的に評価した値です。
以下の式で算出されます。※`pfpoint`=能力値、`level`=楽曲の難易度、`difficulty`=難易度区分（`Normal`=0,`Hard`=1,`Chaos`=2）、`score`=スコア、`maxcombo`=最大コンボ

`pfpoint=10*(level/10)*(score/10000000*1.5)*(1+maxcombo/1000)+(1+0.25*difficulty)*(score/10000000)`

また、プレイヤーの実力を表す指標としての総合能力値は以下の式で算出されます。

※`P`=総合能力値、`p`=保有する譜面の能力値を大きい順にソートした配列変数
$$
P=\frac{1}{10} \sum_{x=0}^{10} p_x
$$
